[SERVICE]
    # Flush interval in seconds
    Flush         5
    # Daemon mode (off for Docker)
    Daemon        Off
    # Log level
    Log_Level     info
    # Parsers file
    Parsers_File  parsers.conf
    # HTTP Server for health checks
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020
    # Storage backpressure
    storage.path              /var/log/flb-storage/
    storage.sync              normal
    storage.checksum          off
    storage.backlog.mem_limit 5M

# ==================== INPUTS ====================

# TCP Input for JSON logs from applications
[INPUT]
    Name              tcp
    Listen            0.0.0.0
    Port              24224
    Format            json
    Tag               app.raw
    Chunk_Size        32KB
    Buffer_Size       64KB
    storage.type      filesystem

# Forward protocol input (for Docker logging driver)
[INPUT]
    Name              forward
    Listen            0.0.0.0
    Port              24225
    Tag               docker.raw
    storage.type      filesystem

# ==================== FILTERS ====================

# Include filters from external file
@INCLUDE filters.conf

# ==================== OUTPUTS ====================

# Application Logs Index
[OUTPUT]
    Name              es
    Match             logs.application.*
    Host              ${ELASTICSEARCH_HOST}
    Port              ${ELASTICSEARCH_PORT}
    Index             application-logs
    Type              _doc
    Suppress_Type_Name On
    Generate_ID       On
    Write_Operation   create
    Replace_Dots      On
    Retry_Limit       5
    Buffer_Size       5MB
    Pipeline          logs-pipeline

# Audit Logs Index
[OUTPUT]
    Name              es
    Match             logs.audit.*
    Host              ${ELASTICSEARCH_HOST}
    Port              ${ELASTICSEARCH_PORT}
    Index             audit-logs
    Type              _doc
    Suppress_Type_Name On
    Generate_ID       On
    Write_Operation   create
    Replace_Dots      On
    Retry_Limit       5
    Buffer_Size       5MB
    Pipeline          logs-pipeline

# Chaos Events Index
[OUTPUT]
    Name              es
    Match             logs.chaos.*
    Host              ${ELASTICSEARCH_HOST}
    Port              ${ELASTICSEARCH_PORT}
    Index             chaos-events
    Type              _doc
    Suppress_Type_Name On
    Generate_ID       On
    Write_Operation   create
    Replace_Dots      On
    Retry_Limit       5
    Buffer_Size       5MB
    Pipeline          logs-pipeline

# Security Events Index
[OUTPUT]
    Name              es
    Match             logs.security.*
    Host              ${ELASTICSEARCH_HOST}
    Port              ${ELASTICSEARCH_PORT}
    Index             security-events
    Type              _doc
    Suppress_Type_Name On
    Generate_ID       On
    Write_Operation   create
    Replace_Dots      On
    Retry_Limit       5
    Buffer_Size       5MB
    Pipeline          logs-pipeline

# Dead Letter Queue for invalid logs
[OUTPUT]
    Name              es
    Match             logs.dlq.*
    Host              ${ELASTICSEARCH_HOST}
    Port              ${ELASTICSEARCH_PORT}
    Index             dead-letter-logs
    Type              _doc
    Suppress_Type_Name On
    Generate_ID       On
    Write_Operation   create
    Replace_Dots      On
    Retry_Limit       3

# Stdout for debugging (development only)
[OUTPUT]
    Name              stdout
    Match             logs.debug.*
    Format            json_lines
