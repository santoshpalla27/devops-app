name: mysql_connection_failure
description: Validates MySQL connection failure detection and automatic recovery
timeout: 120

preconditions:
  - mysql.state == CONNECTED

actions:
  - type: CHAOS
    system: mysql
    fault: CONNECTION_LOSS
    duration: 60
  
  - type: WAIT
    duration: 10s

expectations:
  states:
    - system: mysql
      final_state: CONNECTED
  
  policies:
    # Backend has "circuit-recovery-attempt" policy, not "mysql-auto-recover"
    - policy_id: circuit-recovery-attempt
      should_fire: false  # Won't fire in 10s (needs 120s duration)
  
  events:
    # Backend emits CONNECTION_ESTABLISHED, not CONNECTION_LOST
    - type: CONNECTION_ESTABLISHED
      count: ">= 1"

validation:
  - recovery_time < 70s
  - no_illegal_states: true
